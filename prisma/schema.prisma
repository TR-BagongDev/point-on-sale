generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String              @id @default(cuid())
  name          String
  email         String              @unique
  password      String
  role          String              @default("KASIR")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  lastLoginAt   DateTime?
  targetLogs    ActivityLog[]       @relation("TargetUserActivityLog")
  activityLogs  ActivityLog[]       @relation("UserActivityLog")
  orders        Order[]
  modifications OrderModification[]
}

model Category {
  id    String  @id @default(cuid())
  name  String
  icon  String?
  color String?
  order Int     @default(0)
  menus Menu[]
}

model Menu {
  id          String      @id @default(cuid())
  name        String
  description String?
  price       Float
  image       String?
  categoryId  String
  isAvailable Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  category    Category    @relation(fields: [categoryId], references: [id])
  orderItems  OrderItem[]
}

model Order {
  id            String              @id @default(cuid())
  orderNumber   String              @unique
  userId        String
  subtotal      Float
  tax           Float               @default(0)
  discount      Float               @default(0)
  total         Float
  paymentMethod String              @default("CASH")
  status        String              @default("PENDING")
  notes         String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  syncedAt      DateTime?
  user          User                @relation(fields: [userId], references: [id])
  items         OrderItem[]
  modifications OrderModification[]
}

model OrderItem {
  id       String  @id @default(cuid())
  orderId  String
  menuId   String
  quantity Int
  price    Float
  notes    String?
  menu     Menu    @relation(fields: [menuId], references: [id])
  order    Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model OrderModification {
  id          String   @id @default(cuid())
  orderId     String
  userId      String
  action      String
  description String
  changes     String?
  createdAt   DateTime @default(now())
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id])
}

model ReceiptTemplate {
  id          String   @id @default(cuid())
  name        String
  header      String?
  footer      String?
  logo        String?
  showDate    Boolean  @default(true)
  showTime    Boolean  @default(true)
  showCashier Boolean  @default(true)
  showTax     Boolean  @default(true)
  paperWidth  Int      @default(80)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Setting {
  id        String   @id @default(cuid())
  storeName String
  address   String?
  phone     String?
  npwp      String?
  taxRate   Float    @default(0)
  currency  String   @default("IDR")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ActivityLog {
  id           String   @id @default(cuid())
  userId       String
  action       String
  details      String?
  targetUserId String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())
  targetUser   User?    @relation("TargetUserActivityLog", fields: [targetUserId], references: [id])
  user         User     @relation("UserActivityLog", fields: [userId], references: [id])
}
